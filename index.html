<!DOCTYPE html5>
<html lang="en">

<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style type="text/css">

    </style>
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
        crossorigin="anonymous"></script>
        <script src="./build/indexedDB.js"></script>
</head>

<body>
    <div class="main-container">
        <div class="container">
            <div class="row">
                <h2 class="text-center">To-Do List</h2>
            </div>
            <div class="row">
                <div class="col-md-5 col-md-offset-4">
                    <form class="form-inline">
                        <div class="form-group">
                            <input type="text" class="form-control" id="val">
                        </div>
                        <button id="add" class="btn btn-default" type="button">Add Data</button>
                    </form>
                    <!--<button id="load" class="btn btn-default">Load Data</button>-->
                </div>
            </div>
            <div class="row  col-md-4 col-md-offset-4">
                <h6 class="text-center"> List of ToDo Task</h6>

                <ul id="task-container" class="text-center list-group">

                </ul>
            </div>
        </div>
    </div>
    <script id="listTemplate" type="text/template">
        <li>
            <div class="checkbox">
                <label>
                <input type="checkbox" value="">
                {{Text}} {{CreatedAt}}
            </label>
            </div>
            <li>
    </script>
    <script type="text/javascript">
        (function (dbConnection) {
            var model = {
                repository: (function () {
                    var contextContainer = new IndexedDB.SampleContext(dbConnection);
                    contextContainer.Upgrade = {
                        Version: 3,
                        UpgradeSetting: function (db) {
                            this.CreateObjectSet(db, { name: "Sample5", keyPath: "id", autoIncrement: true });
                            this.CreateObjectSet(db, { name: "Sample6", keyPath: "id", autoIncrement: true });
                            this.CreateObjectSet(db, { name: "Sample7", keyPath: "id", autoIncrement: true });
                        }
                    };
                    console.log(contextContainer);
                    return new IndexedDB.SampleRepository(contextContainer);
                })()
            };
            var controller = {
                init: function () {
                    view.init();
                },
                add: function (data) {
                    model.repository.Add(data).then(controller.readAll, function () {
                        alert('asdfas');
                    });
                },
                readAll: function () {
                    model.repository.GetAll().then(view.render);

                },
                remove: function (id) {
                    model.repository.Delete(id).then(controller.readAll);
                }
            };

            var view = {
                init: function () {
                    this.$container = $('#task-container');
                    $('#load').click(function () {
                        controller.readAll();
                    })
                    $('#add').click(function () {
                        var val = $('#val').val();
                        var obj = { id: Date.now(), value: val };
                        controller.add(obj);
                        $('#val').val("");
                    });
                    controller.readAll();
                },
                render: function (data) {
                    $(view.$container).html('');
                    for (var d of data) {
                        var li = $(document.createElement('li'));
                        li.attr('id', d.id);
                        li.addClass('list-group-item')
                        li.text(d.value);
                        li.click(function () {
                            controller.remove(d.id);
                        })
                        var li = $(view.$container).append(li);
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                controller.init();
            })
        } (window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB));
    </script>
</body>

</html>