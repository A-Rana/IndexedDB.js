<!DOCTYPE html5>
<html lang="en">

<head>
    <title>IndexedDB.js | Demo</title>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-light_blue.min.css" />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
     <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
        crossorigin="anonymous"></script>
    <style>
        body {
            background: #ccc;
            color: #fff;
        }
    </style>
    <script src="./build/indexedDB.js"></script>
</head>

<body>
    <div class="mdl-grid" style="margin: 0 auto;">
        <div class="mdl-cell mdl-cell--12-col">
            <h3 style="text-align: center">TODO Task</h3>
        </div>
    </div>
    <div class="mdl-grid" style="margin: 0 auto;">
        <div class="mdl-cell mdl-cell--12-col">
            <div class="mdl-card  mdl-shadow--2dp" style="min-height: auto;margin: 0 auto;width:410px">
                <div class="mdl-card__supporting-text">
                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                        <input class="mdl-textfield__input" type="text" id="val">
                        <label class="mdl-textfield__label" for="val">Add Task ...</label>
                    </div>
                    <button id ="add"class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" style="vertical-align: super;color:#fff">Add</button>
                </div>
            </div>
        </div>
    </div>
    <div class="mdl-grid" style="margin: 0 auto;">
        <div class="mdl-cell mdl-cell--12-col" id ="task-container">
        </div>
    </div>
    <script type="text/template" id="task-template">
        <div class="mdl-card  mdl-shadow--2dp" style="min-height: auto;margin: 0 auto;width:410px;margin-bottom: 0.5%">
            <div class="mdl-card__supporting-text">
                <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="{{ID}}">
                        <input type="checkbox" id="{{ID}}" class="mdl-checkbox__input" >
                        <span class="mdl-checkbox__label">{{Checkbox}}</span>
                    </label>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        (function (dbConnection) {
            var model = {
                repository: (function () {
                    IndexedDB.DbContextBuilder.Debug(false);
                    var sampleContextBuilder = new IndexedDB.DbContextBuilder(dbConnection);
                    var repositories = sampleContextBuilder
                        .CreateDB("Sample")
                        .ConfigureModel({
                            name: "Sample",
                            keyPath: "id",
                            autoIncrement: false
                        }).Build();
                    return repositories.Sample;
                })()
            };
            var controller = {
                init: function () {
                    view.init();
                },
                add: function (data) {
                    model.repository.Add(data).then(controller.readAll, function () {
                        alert('asdfas');
                    });
                },
                readAll: function () {
                    model.repository.GetAll().then(view.render);

                },
                remove: function (id) {
                    model.repository.Delete(id).then(controller.readAll);
                }
            };

            var view = {
                init: function () {
                    this.$container = $('#task-container');
                    this.$taskTemplate = $('#task-template').html();
                    $('#add').click(function () {
                        var val = $('#val').val();
                        var obj = { id: Date.now(), value: val };
                        controller.add(obj);
                        $('#val').val("");
                    });
                    controller.readAll();
                },
                render: function (data) {
                    $(view.$container).html('');
                    for (var d of data) {
                        var str  = view.$taskTemplate.replace(/{{Checkbox}}/g, d.value).replace(/{{ID}}/g, d.id);
                        $(view.$container).append(str);
                    }
                    componentHandler.upgradeDom();
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                controller.init();
            })
        } (window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB));
    </script>
</body>

</html>